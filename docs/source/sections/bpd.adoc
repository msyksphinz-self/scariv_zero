== 分岐予測の詳細

本節では、SCARIVの採用している分岐予測について説明します。

SCARIVは大きく分けて以下の分岐予測器を搭載しています。

GSHARE::
  グローバル履歴に基づいて分岐予測を行います。

RAS (戻り値アドレススタック, Return Address Stack)::
  関数ジャンプなどの場合、その関数が戻ってくる場所(関数ジャンプ命令の次のアドレス)をRASと呼ばれるスタックに保存します。
  関数から戻る命令がフェッチされた際にRASから値を取り出して命令フェッチに使用します。

=== GSHAREによる分岐予測の詳細

GSHAREによる分岐予測は、フェッチステージF0-F2にかけて行われます。
各ステージでの処理を以下に示します。

F0ステージ::
  BTB(Branch Target Buffer)に現在のフェッチ・アドレスを渡し、分岐命令の情報及び過去の分岐情報の検索を要求します。
F1ステージ::
  BTBから結果が返されます。BTBの情報に基づき、グローバル履歴を構成したのちにGShareによる分岐予測を行うためのグローバル履歴を構成します。
F2ステージ::
  グローバル履歴に基づいてBimodalカウンタの値を取得し、分岐予測を行います。

==== 対応するパラメータ

`scariv_conf_pkg::BTB_ENTRY_SIZE`::
BTBのエントリ数が決定されます。

`scariv_conf_pkg::GSHARE_BHT_W`::
GShareで使用するBHTのビット長が決定されます。

=== RASによる分岐予測の詳細

RASはInstruction Buffer内に実装されており、Instruction Buffer内の命令のデコード結果に応じてRASの更新が行われます。

==== 対応するパラメータ

`scariv_conf_pkg::RAS_ENTRY_SIZE`::
RASのエントリ数を指定します。
